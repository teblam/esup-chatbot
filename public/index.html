<!DOCTYPE html>
<html>
<head>
    <title>UPHF Chatbot</title>
    <link rel="stylesheet" href="/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <div id="app">
        <!-- Formulaire de connexion -->
        <div v-if="!user" id="auth-container">
            <div class="auth-box">
                <h2>{{ isRegistering ? 'Inscription' : 'Connexion' }}</h2>
                <form @submit.prevent="isRegistering ? register() : login()">
                    <!-- Informations de base -->
                    <div class="form-group">
                        <label for="username">Nom d'utilisateur</label>
                        <input 
                            type="text" 
                            id="username" 
                            v-model="authForm.username" 
                            required
                            placeholder="Entrez votre nom d'utilisateur"
                        >
                    </div>

                    <div class="form-group">
                        <label for="password">Mot de passe</label>
                        <input 
                            type="password" 
                            id="password" 
                            v-model="authForm.password" 
                            required
                            placeholder="Entrez votre mot de passe"
                        >
                    </div>
                    
                    <!-- Champs supplémentaires pour l'inscription -->
                    <template v-if="isRegistering">
                        <div class="form-group">
                            <label for="uphfUsername">Identifiant UPHF</label>
                            <input 
                                type="text" 
                                id="uphfUsername" 
                                v-model="authForm.uphfUsername" 
                                required
                                placeholder="Votre identifiant UPHF"
                            >
                        </div>

                        <div class="form-group">
                            <label for="uphfPassword">Mot de passe UPHF</label>
                            <input 
                                type="password" 
                                id="uphfPassword" 
                                v-model="authForm.uphfPassword" 
                                required
                                placeholder="Votre mot de passe UPHF"
                            >
                        </div>

                        <div class="form-group">
                            <label for="preferredLanguage">Langue préférée</label>
                            <select 
                                id="preferredLanguage" 
                                v-model="authForm.preferredLanguage"
                                required
                            >
                                <option value="fr">Français</option>
                                <option value="en">English</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="preferredRestaurant">Restaurant préféré</label>
                            <select 
                                id="preferredRestaurant" 
                                v-model="authForm.preferredRestaurant"
                                required
                            >
                                <option value="1184">Restaurant Universitaire Ronzier</option>
                                <option value="1165">Restaurant Universitaire Rambouillet</option>
                                <option value="1175">Cafétéria IUT</option>
                                <option value="1176">Cafétéria Matisse</option>
                                <option value="1182">Mont Houy 1</option>
                                <option value="1183">Mont Houy 2</option>
                            </select>
                        </div>
                    </template>

                    <button type="submit">
                        {{ isRegistering ? "S'inscrire" : "Se connecter" }}
                    </button>
                    
                    <p class="auth-switch">
                        {{ isRegistering ? 'Déjà inscrit ?' : 'Pas encore de compte ?' }}
                        <a href="#" @click.prevent="isRegistering = !isRegistering">
                            {{ isRegistering ? 'Se connecter' : "S'inscrire" }}
                        </a>
                    </p>
                </form>
            </div>
        </div>

        <!-- Interface principale -->
        <div v-else class="main-interface">
            <!-- Barre de navigation -->
            <div class="nav-bar">
                <div class="user-info">
                    <span class="username">{{ user.username }}</span>
                </div>
                <button @click="logout">Se déconnecter</button>
            </div>

            <!-- Sidebar des conversations -->
            <div class="sidebar" :class="{ 'sidebar-hidden': !showSidebar }">
                <div class="sidebar-header">
                    <button class="new-chat-btn" @click="createNewConversation">
                        Nouvelle conversation
                    </button>
                </div>
                <div class="conversation-list">
                    <div v-for="conv in conversations" 
                         :key="conv.id" 
                         :class="['conversation-item', { active: currentConversation && currentConversation.id === conv.id }]"
                         @click="selectConversation(conv)">
                        {{ conv.title }}
                    </div>
                </div>
            </div>

            <!-- Interface de chat -->
            <div id="chat-container">
                <div id="messages" ref="messagesContainer">
                    <div v-for="message in messages" :key="message.id" 
                         :class="['message', message.role]">
                        <div class="message-content markdown-content" 
                             v-html="marked(message.content)">
                        </div>
                    </div>
                </div>
                <div class="loader" v-show="isLoading"></div>
                <form @submit.prevent="sendMessage">
                    <input type="text" v-model="userInput" 
                           placeholder="Posez votre question...">
                    <button type="submit">Envoyer</button>
                </form>
            </div>
        </div>
    </div>

    <script src="/app.js"></script>
</body>
</html>